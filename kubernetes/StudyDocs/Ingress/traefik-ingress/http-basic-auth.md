# 使用http basic auth给traefik页面加密

## 一、安装httpd-tools工具

```shell
yum install httpd-tools
```

## 二、生成密码

```shell
htpasswd -nb admin test|openssl base64
#得到base64加密后的密码
YWRtaW46JGFwcjEkSEkyczRPTDYkbmc0LnBGdjlOemVDcnFyWnlCL1BXLgoK
```

## 三、创建Middleware

```yaml
# Declaring the user list
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: traefik-auth
  namespace: kube-system
spec:
  basicAuth:
    secret: traefik-secret

---
# Note: in a kubernetes secret the string (e.g. generated by htpasswd) must be base64-encoded first.
# To create an encoded user:password pair, the following command can be used:
# htpasswd -nb user password | openssl base64

apiVersion: v1
kind: Secret
metadata:
  name: traefik-secret
  namespace: kube-system
data:
  admin: |2
    YWRtaW46JGFwcjEkSEkyczRPTDYkbmc0LnBGdjlOemVDcnFyWnlCL1BXLgoK
```

## 四、在IngressRoute中加入auth

```yaml
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: traefik-dashboard-route
  namespace: kube-system
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`traefik.test.test`)
      kind: Rule
      services:
        - name: traefik
          port: 8080
      middlewares:
      - name: traefik-auth
```

